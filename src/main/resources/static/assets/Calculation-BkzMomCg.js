import{r,j as e,R as E,k as z,u as A,g as L}from"./index-WSm8V2ST.js";import{a as $}from"./axios-upsvKRUO.js";import{P as B}from"./pic-Bp3CpqNF.js";import{M as T}from"./index-DiTis_ES.js";import{B as k}from"./button-DdYXoYhD.js";import{T as F}from"./TitleHeader-CGwkCU68.js";import{F as O}from"./index-1EUDdVBk.js";import{s as I}from"./index-DK3Dx2QH.js";import"./ExclamationCircleFilled-xsY2f4U_.js";import"./ContextIsolator-D6Qa4Vnz.js";import"./Keyframes-BXC_0NBG.js";import"./context-DbhbiqRO.js";import"./InfoCircleFilled-_br9GsSA.js";import"./CloseOutlined-BzJUIVo8.js";import"./KeyCode-DNlgD2sM.js";import"./Skeleton-BQ1iQ9oo.js";import"./useLocale-CiZtlZfJ.js";import"./index-CUj9tipH.js";import"./fade-B2TkqYYX.js";import"./PurePanel-BVZw4gEZ.js";import"./iconBase-C31Zs2Ot.js";const D=({deId:t,getCookie:m,isStatementOpen:h,setIsStatementOpen:b})=>{var p;const[o,v]=r.useState([]),u=m("accessToken");console.log("deId 내놔",t);const d=async()=>{if(!(!h||!t))try{const a=await $.get(`/api/expense/select?de_id=${t}&trip_id=1`,{headers:{Authorization:`Bearer ${u}`}});v(a.data.data),console.log("isReceipt",o),console.log("amount",amount),console.log("✅  getStatement :",a.data.data)}catch(a){console.log("✅  error:",a)}};r.useEffect(()=>{d()},[t]);const x=()=>{b(!1)},i=()=>{b(!1)};return e.jsx("div",{children:e.jsx(T,{title:"계산서",open:h,onOk:x,onCancel:i,footer:[e.jsx(k,{onClick:i,children:"확인"},"back"),e.jsx(k,{type:"primary",onClick:x,children:"수정"},"submit")],children:e.jsxs("div",{className:"px-8 pb-5",children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-700 flex items-end gap-3 py-5",children:["🧾",o.paidFor]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl text-slate-500 font-semibold py-5 border-y-2 border-dashed border-slate-300",children:"결제 금액"}),e.jsxs("div",{className:"py-5",children:[e.jsx("p",{className:"text-xl text-slate-700 font-semibold mr-auto",children:"총 지출액"}),e.jsx("p",{className:"text-2xl font-bold text-slate-700",children:o.totalPrice})]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl text-slate-500 font-semibold py-5 border-y-2 border-dashed border-slate-300",children:"정산 내역"}),e.jsx("div",{children:(p=o==null?void 0:o.payList)==null?void 0:p.map(a=>e.jsxs("div",{className:"flex items-center py-5",children:[e.jsxs("div",{className:"flex items-center gap-5 mr-auto",children:[e.jsx("p",{className:"w-12 h-12 rounded-full overflow-hidden",children:e.jsx("img",{src:`${B}${a==null?void 0:a.userId}/${a==null?void 0:a.profilePic}`,alt:a.name})}),e.jsx("p",{className:"text-xl text-slate-700 font-semibold",children:a.name})]}),e.jsxs("p",{className:"text-2xl  text-slate-500",children:[a.price,"원"]})]},a.userId))})]})]})})})},R=({getCookie:t,isBillOpen:m,setIsBillOpen:h,userInfo:b,getExpenses:o})=>{const[v,u]=r.useState([]),[d,x]=r.useState("0"),[i,p]=r.useState(""),a=t("accessToken"),[N,f]=r.useState({}),[C,j]=r.useState([]),l=async()=>{try{const s=await $.get("/api/expense/trip_user?trip_id=1",{headers:{Authorization:`Bearer ${a}`}});console.log("res",s),u(s.data.data)}catch(s){console.log("✅  getBudgeting  error:",s),u([])}},w=async()=>{var c;const s={trip_id:1,total_price:d,paid_user_list:C,paid_for:i};console.log("sendData",s);try{const g=await $.post("/api/expense",s,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});I.success("추가 되었습니다"),h(!1),o()}catch(g){console.log("✅  error:",(c=g.response)==null?void 0:c.data,s)}};r.useEffect(()=>{l()},[]);const _=s=>{f(c=>{const g={...c,[s]:!c[s]},P=Object.keys(g).filter(U=>g[U]);return j(P),console.log("paid_user_list:",P),g})},y=()=>{if(!i){I.error("내용을 입력해 주세요");return}if(Number(d)<1e3){I.error("가격은 1000원 이상이어야 합니다");return}w(),x("0"),p(""),f({}),j([])},n=()=>{h(!1),x("0"),p(""),f({}),j([])},S=s=>{let c=s.target.value.replace(/\D/g,"");c===""&&(c="0"),x(c)};return e.jsxs(T,{title:"정산하기",open:m,onOk:y,onCancel:n,footer:[e.jsx(k,{onClick:n,children:"취소"},"back"),e.jsx(k,{type:"primary",onClick:y,children:"추가"},"submit")],children:[e.jsx("p",{className:"text-lg text-slate-500 font-semibold px-8",children:"지출 금액"}),e.jsxs("label",{htmlFor:"",className:"flex px-8 mt-3 mb-10",children:[e.jsx("input",{type:"text",name:"expenditurePice",value:d,onChange:S,className:"w-11/12 !border-none !border-transparent outline-0 !shadow-none text-4xl font-bold text-slate-700 !text-right  "}),e.jsx("span",{className:"text-4xl font-bold text-slate-700",children:"원"})]}),e.jsxs("label",{htmlFor:"",className:"text-lg text-slate-500 font-semibold px-8 w-full inline-block",children:["지출 내용",e.jsx("input",{type:"text",name:"expenditureName",value:i,onChange:s=>p(s.target.value),className:"h-20 w-full border border-slate-300 rounded-2xl px-5 mt-3 text-2xl text-slate-700 outline-none"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"px-8 w-full py-5 border-y border-slate-200 text-lg font-semibold text-slate-500 mt-8",children:"참여자"}),v.map(s=>e.jsxs("div",{className:"flex items-center mt-8 justify-between px-8",children:[e.jsxs("div",{className:"flex items-center gap-5 ",children:[e.jsx("p",{className:"w-16 h-16 rounded-full overflow-hidden",children:e.jsx("img",{src:`${B}${s==null?void 0:s.user_id}/${s.profile_pic}`,alt:s.name})}),e.jsx("p",{className:"text-lg text-slate-700 font-semibold",children:s.name})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:N[s.user_id]||!1,onChange:()=>_(s.user_id),className:"peer hidden"}),e.jsx("div",{className:"w-11 h-11 bg-slate-100  rounded-full flex items-center justify-center transition duration-300 peer-checked:bg-primary2 peer-checked:bg-opacity-50",children:e.jsx(O,{className:`text-2xl duration-300 ${N[s.user_id]?"text-primary":"text-slate-400"}`})})]})]},s.user_id))]})]})},ce=()=>{var f,C,j;const[t,m]=r.useState({}),[h,b]=r.useState(null),[o,v]=E(z),[u,d]=r.useState(!1),[x,i]=r.useState(!1),p=A(),a=L("accessToken"),N=async()=>{try{const l=await $.get("/api/expense?trip_id=1",{headers:{Authorization:`Bearer ${a}`}});m(l.data.data),console.log("✅  res.data:",l.data.data)}catch(l){console.log("✅  getExpenses  error:",l),m(null)}};return r.useEffect(()=>{N()},[]),e.jsxs("div",{className:"bg-slate-100 pb-4",children:[e.jsx(F,{icon:"back",title:"가계부",onClick:()=>p(-1),className:"!bg-slate-100"}),e.jsxs("div",{className:"px-8",children:[e.jsxs("div",{className:"bg-white rounded-3xl px-8",children:[e.jsxs("div",{className:" flex items-end gap-3 border-b  py-8 border-slate-200",children:[e.jsx("h2",{className:"text-2xl text-slate-700 font-bold",children:t==null?void 0:t.title}),e.jsx("span",{className:"text-base text-slate-400",children:t==null?void 0:t.tripPeriod})]}),e.jsxs("div",{className:"py-8 border-b border-slate-200",children:[e.jsx("h3",{className:"text-xl font-semibold text-slate-700",children:"내가 쓴 금액"}),e.jsxs("h2",{className:"text-4xl text-primary font-semibold",children:[(f=t==null?void 0:t.myTotalPrice)==null?void 0:f.toLocaleString(),"원"]})]}),e.jsxs("div",{className:"py-8 flex",children:[e.jsx("h1",{className:"text-lg text-slate-500 mr-auto",children:"총 지출 금액"}),e.jsxs("span",{className:"text-2xl text-slate-700 font-semibold",children:[(C=t==null?void 0:t.tripTotalPrice)==null?void 0:C.toLocaleString(),"원"]})]})]}),e.jsx("div",{children:(j=t==null?void 0:t.expensedList)==null?void 0:j.map(l=>{var w,_,y;return e.jsx("div",{className:"cursor-pointer bg-white px-8 py-5 rounded-3xl mt-5",onClick:()=>{i(!0),b(l.deId)},children:e.jsxs("div",{className:"",children:[e.jsx("p",{className:"text-lg text-slate-500",children:l.paidFor}),e.jsxs("p",{className:"mt-1 text-3xl text-slate-700 font-semibold",children:[(w=l.totalPrice)==null?void 0:w.toLocaleString(),"원"]}),e.jsxs("div",{className:"flex items-center gap-3 mt-5",children:[l.paidUserList.slice(0,3).map((n,S)=>e.jsxs("span",{className:"inline-block w-14 h-14 !border-4 border-white rounded-full overflow-hidden -ml-9 first:ml-0 ",style:{zIndex:9-S},children:[e.jsx("img",{src:`${B}${n==null?void 0:n.user_id}/${n==null?void 0:n.profile_pic}`||"/images/user.png",alt:n.name}),S!==l.paidUserList.length-1&&", "]},n.user_id)),e.jsx("span",{className:"text-lg text-slate-500 font-semibold",children:l.paidUserList.length===1?`${(_=l.paidUserList[0])==null?void 0:_.name}`:`${(y=l.paidUserList[0])==null?void 0:y.name} 외 ${l.paidUserList.length-1}명`})]})]})},l.deId)})}),e.jsx(k,{type:"primary",className:"sticky bottom-5 h-16 w-full rounded-2xl text-xl z-50 mt-5",onClick:()=>d(!0),children:"비용 추가"})]}),e.jsx("div",{children:e.jsx(R,{getCookie:L,isBillOpen:u,setIsBillOpen:d,userInfo:o,getExpenses:N})}),e.jsx("div",{children:e.jsx(D,{deId:h,getCookie:L,isStatementOpen:x,setIsStatementOpen:i})})]})};export{ce as default};
