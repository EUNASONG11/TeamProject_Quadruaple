<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.green.project_quadruaple.trip.TripMapper">
    <select id="getBeforeTripList">
        SELECT
            t.trip_id AS tripId
            , t.title AS title
            , t.start_at AS startAt
            , t.end_at AS endAt
            , l.location_pic AS locationPic
            , count(sm.schedule_memo_id) AS scheduleCnt
        FROM trip t
        JOIN trip_user tu
            ON tu.trip_id = t.trip_id
            AND tu.user_id = #{userId}
        JOIN trip_location tl
            ON tl.trip_id = t.trip_id
        LEFT JOIN location l
            ON l.location_id = tl.location_id
        JOIN sche_memo sm
            ON sm.trip_id = t.trip_id
            AND sm.category = 'SCHE'
        <if test="bOrA = 0">
            WHERE t.end_at &lt; #{currentAt}
        </if>
        <if test="bOrA = 1">
            WHERE t.end_at &gt; #{currentAt}
        </if>
        GROUP BY t.trip_id
    </select>
</mapper>
